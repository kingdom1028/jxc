(function(a){a.fn.autoComplete=function(h){var y;var r;var u;var g=a(this);var i;var x;var m=new Array();var j={width:g.width(),maxheight:264,top:2,header:null,url:"",type:"post",async:false,autoLength:0,getValue:function(p){},selected:function(p){},canceled:function(){}};u=a.extend(j,h);var v=g.position();i=a('<div class="autoCompleteBox"></div>');i.attr("id","autoComplete_Group_"+Math.random());g.after(i);i.css({"left":v.left,"top":v.top+g.height()+u.top,"width":u.width,"max-height":u.maxheight});x=a('<table cellspacing="0" cellpadding="5"></table>');var n=a("<div></div>");i.append(n);i.append(x);g.bind("keydown",o);g.bind("keyup",q);g.bind("blur",f);i.bind("focus",k);i.bind("mouseout",s);function f(){u.canceled();y=setTimeout(function(){i.hide()},200)}function s(){x.find(".nowRow").removeClass("nowRow");a(this).find("td").css({"background":"#FFFFFF","border-bottom":"soild 1px #d7d7d7"})}function k(){clearTimeout(y);g.focus()}function o(t){if(i.is(":hidden")){return}switch(t.keyCode){case 38:t.preventDefault();var A=x.find(".nowRow").prev();if(A.length>0){i.setScroll(u.maxheight,A,i);i.setHeaderTop(n);A.mouseover()}else{A=x.find("tr:last");if(A.length>0){i.setScroll(u.maxheight,A,i);i.setHeaderTop(n);A.mouseover()}}break;case 40:t.preventDefault();var z=x.find(".nowRow").next();if(z.length>0){i.setScroll(u.maxheight,z,i);i.setHeaderTop(n);z.mouseover()}else{z=x.find("tr:first");if(z.length>0){i.setScroll(u.maxheight,z,i);i.setHeaderTop(n);z.mouseover()}}break;case 13:t.preventDefault();var z=x.find(".nowRow");if(z.length>0){u.selected(e(z.attr("rowValue")));r="";i.hide()}break}}function q(p){if(p.keyCode==38||(!i.is(":hidden")&&p.keyCode==40)||p.keyCode==13||p.keyCode==37||p.keyCode==39){return}if(g.val()==""||g.val().length>u.autoLength){if(g.val()!=""&&g.val()==r){return}l(g,function(A){if(A.length==0){i.hide();return}if(u.header!=null&&x.find("thead").length==0){m.length=0;var D=a("<thead></thead>");for(var B in u.header){if(typeof(u.header[B])!="function"){D.append("<th>"+u.header[B]+"</th>");m.push(B)}}x.append(D)}x.find("tr").remove();a.each(A,function(){var G=a("<tr></tr>");G.attr("rowValue",b(this));if(m.length>0){for(var E=0;E<m.length;E++){G.append("<td style=\"background:#FFFFFF;border-bottom:soild 1px #d7d7d7;\" onmouseover=\"$(this).parent().find('td').css({'background':'#ecf4ff','border-bottom':'soild 1px #bdd1eb'})\" onmouseout=\"$(this).parent().find('td').css({'background':'#FFFFFF','border-bottom':'soild 1px #d7d7d7'})\">"+c(this[m[E]],g.val())+"</td>")}}else{for(var F in this){if(typeof(this[F])!="function"){G.append("<td>"+this[F]+"</td>")}}}x.append(G)});var C=x.find("tr");C.first().addClass("nowRow");C.mouseover(function(){x.find(".nowRow").removeClass("nowRow");x.find("td").css({"background":"#FFFFFF","border-bottom":"soild 1px #d7d7d7"});a(this).addClass("nowRow");a(this).find("td").css({"background":"#ecf4ff","border-bottom":"soild 1px #bdd1eb"})});C.click(function(){u.selected(e(a(this).attr("rowValue")));r="";i.hide()});g.setBoxPosition(g,i,u.top);i.show()});r=g.val();if(x.find("thead>th").length>0){n.css({"position":"absolute","background":"#FF0000"});n.children().remove();var t=a('<table cellspacing="0" cellpadding="2"></table>');var z=a("<thead></thead>");x.find("thead>th").each(function(){var A=a("<th>"+a(this).html()+"</th>");A.css({"height":a(this).height(),"width":a(this).width()});z.append(A)});t.append(z);n.append(t)}}else{r="";i.hide()}}function l(p,t){a.ajax({type:u.type,async:u.async,url:u.url,data:{"key":p.val()},dataType:"json",cache:false,success:t,Error:function(z){alert(z)}})}};function b(j){var f=[];var g=function(i){if(typeof i=="object"&&i!=null){alert(typeof i);return b(i)}if(i==null){i=""}i=i.toString().replace(/'/g,"\\'").replace(/\"/g,'\\"');return/^(string|number)$/.test(typeof i)?"'"+i+"'":i};for(var h in j){f.push("'"+h+"':"+g(j[h]))}return"{"+f.join(",")+"}"}function e(f){eval("var jsonValue = "+f);return jsonValue}function c(n,l){if(""==l.replace(/ /g,"").replace(/ã€€/g,"")){return n}var g=new RegExp("<.*?>","i");var f=new Array();for(var h=0;true;h++){var j=g.exec(n);if(j){f[h]=j}else{break}n=n.replace(j,"{[("+h+")]}")}words=unescape(l.replace(/\+/g," ")).split(/\s+/);for(w=0;w<words.length;w++){var k=new RegExp("("+words[w].replace(/[(){}.+*?^$|\\\[\]]/g,"\\$&")+")","ig");n=n.replace(k,"<span class='key'>$1</span>")}for(var h=0;h<f.length;h++){n=n.replace("{[("+h+")]}",f[h])}return n}a.fn.resetEvent=function(f){f.bind("keydown",keydown_process);f.bind("keyup",keyup_process);f.bind("blur",blur_process);d.bind("focus",focus_div);d.bind("mouseout",mouseout_div)};a.fn.setBoxPosition=function(f,g,i){var h=f.position();g.css({"left":h.left,"top":h.top+f.height()+i})};a.fn.setScroll=function(g,i,f){var j=i.offset();var k=f.position();if(j.top-k.top>g-2){a(this).scrollTop(((j.top-k.top-g)/25+1)*25+a(this).scrollTop())}else{if(j.top-k.top<25){a(this).scrollTop(0)}}};a.fn.setHeaderTop=function(f){f.css("top",a(this).scrollTop())}})(jQuery);